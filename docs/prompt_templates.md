# 提示词模板说明

## 概述
提示词模板是OpenRA系统中用于指导AI进行代码审计和审查的指令集合。通过使用精心设计的提示词模板，可以确保AI从多个维度全面分析代码，发现潜在问题并提供专业的建议。

## 系统预置提示词模板

### 1. 默认代码审计
**描述**：全面的代码审计提示词，涵盖安全、性能、代码质量等多个维度
**适用场景**：通用代码审计，需要全面分析时使用

**核心内容**：
- 安全漏洞检测（SQL注入、XSS、命令注入、路径遍历、SSRF、XXE、反序列化、硬编码密钥等）
- 潜在的Bug和逻辑错误
- 性能问题和优化建议
- 编码规范和代码风格
- 可维护性和可读性
- 最佳实践和设计模式

### 2. 安全专项审计
**描述**：专注于安全漏洞检测的提示词模板
**适用场景**：需要重点关注安全问题的审计

**核心内容**：
- **注入类漏洞**：SQL注入、命令注入、LDAP注入、XPath注入、NoSQL注入
- **跨站脚本（XSS）**：反射型XSS、存储型XSS、DOM型XSS
- **认证与授权**：硬编码凭证、弱密码策略、会话管理问题、权限绕过
- **敏感数据**：敏感信息泄露、不安全的加密、明文传输敏感数据
- **其他安全问题**：SSRF、XXE、反序列化漏洞、路径遍历、文件上传漏洞、CSRF

### 3. 性能优化审计
**描述**：专注于性能问题检测的提示词模板
**适用场景**：需要重点关注性能问题的审计

**核心内容**：
- **数据库性能**：N+1查询问题、缺少索引、不必要的全表扫描、大量数据一次性加载、未使用连接池
- **内存问题**：内存泄漏、大对象未及时释放、缓存使用不当、循环中创建大量对象
- **算法效率**：时间复杂度过高、不必要的重复计算、可优化的循环、递归深度过大
- **并发问题**：线程安全问题、死锁风险、资源竞争、不必要的同步
- **I/O性能**：同步阻塞I/O、未使用缓冲、频繁的小文件操作、网络请求未优化

### 4. 代码质量审计
**描述**：专注于代码质量和可维护性的提示词模板
**适用场景**：需要重点关注代码质量的审计

**核心内容**：
- **代码规范**：命名不规范、代码格式不一致、注释缺失或过时、魔法数字/字符串
- **代码结构**：函数过长、类职责不单一、嵌套层级过深、重复代码
- **可维护性**：高耦合低内聚、缺少错误处理、硬编码配置、缺少日志记录
- **设计模式**：违反SOLID原则、可使用设计模式优化的场景、过度设计
- **测试相关**：难以测试的代码、缺少边界条件处理、依赖注入问题

## 提示词模板的变量

提示词模板支持以下变量，在使用时会被实际值替换：

- `{language}`：编程语言
- `{code}`：代码内容

## 双语支持

所有系统预置的提示词模板都支持中英文双语：
- **中文**：针对中文用户优化的提示词
- **英文**：针对英文用户优化的提示词

系统会根据用户的语言设置自动选择合适的提示词版本。

## 自定义提示词模板

### 创建自定义模板
1. 登录系统后台
2. 导航到「提示词管理」页面
3. 点击「创建模板」按钮
4. 填写模板名称、描述、类型等信息
5. 输入中文和英文提示词内容
6. 定义模板变量（如果需要）
7. 保存模板

### 管理模板
- **启用/禁用**：可以启用或禁用特定的提示词模板
- **编辑**：修改现有模板的内容和设置
- **删除**：删除不需要的模板
- **设置默认**：将某个模板设置为默认使用的模板

## 使用提示词模板

### 通过CLI使用
```bash
# 使用默认模板进行审计
python -m src.cli.main audit --local

# 使用特定模板进行审计（通过配置文件指定）
python -m src.cli.main audit --local --template "安全专项审计"
```

### 通过配置文件使用
在`config/.env`文件中设置：
```
# 默认提示词模板
DEFAULT_PROMPT_TEMPLATE="默认代码审计"
```

## 提示词模板的最佳实践

1. **选择合适的模板**：根据审计目标选择最适合的提示词模板
2. **组合使用**：对于复杂项目，可以结合使用多个模板
3. **自定义优化**：根据项目特点，创建和优化自定义模板
4. **定期更新**：随着安全威胁和最佳实践的变化，定期更新提示词模板
5. **反馈循环**：根据审计结果，不断优化提示词模板

## 示例：使用提示词模板进行审计

### 输入
```python
# 示例代码
import sqlite3

def get_user(user_id):
    conn = sqlite3.connect('users.db')
    cursor = conn.cursor()
    query = f"SELECT * FROM users WHERE id = {user_id}"
    cursor.execute(query)
    return cursor.fetchone()
```

### 输出（使用安全专项审计模板）
```
发现安全漏洞：SQL注入
- **位置**：example.py:7
- **描述**：使用字符串拼接构建SQL查询，存在SQL注入风险
- **风险等级**：高
- **利用方式**：攻击者可以通过传入特殊构造的user_id参数，执行任意SQL语句
- **修复建议**：使用参数化查询
  
  ```python
  def get_user(user_id):
      conn = sqlite3.connect('users.db')
      cursor = conn.cursor()
      query = "SELECT * FROM users WHERE id = ?"
      cursor.execute(query, (user_id,))
      return cursor.fetchone()
  ```
```