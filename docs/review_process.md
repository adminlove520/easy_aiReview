```mermaid
flowchart TB
    subgraph ä»£ç å®¡æŸ¥æ ¸å¿ƒæµç¨‹
        A[ğŸš€ ä»£ç å®¡æŸ¥è¯·æ±‚] --> B[ğŸ“¥ æ¥æ”¶ä»£ç å˜æ›´]
        B --> C{ğŸ” ä»£ç å˜æ›´æ ¼å¼}
        C -->|åˆ—è¡¨æ ¼å¼| D[ğŸ”„ è½¬æ¢ä¸º Diff æ ¼å¼]
        C -->|å­—ç¬¦ä¸²æ ¼å¼| E[âœ… ä¿æŒåŸæ ¼å¼]
        D --> F
        E --> F[ğŸ—£ï¸ è¯­è¨€æ£€æµ‹]
        
        F --> G[ğŸ—£ï¸ ä» Diff æ£€æµ‹è¯­è¨€]
        G --> H{æ£€æµ‹ç»“æœ}
        H -->|default| I[ğŸ“Š ä» Changes æ•°æ®æ£€æµ‹]
        H -->|æˆåŠŸ| J[ğŸ“ æœ€ç»ˆè¯­è¨€]
        I --> J
        J --> K[ğŸ“ è®¡ç®— Token æ•°é‡]
    end
    
    subgraph Token é™åˆ¶æ£€æŸ¥
        K --> L{ğŸ“Š Token æ•°é‡ > REVIEW_MAX_TOKENS?}
        L -->|æ˜¯| M[âœ‚ï¸ æˆªæ–­åˆ°é™åˆ¶]
        L -->|å¦| N[ğŸ“‹ ä½¿ç”¨å®Œæ•´ä»£ç ]
        M --> N
    end
    
    subgraph LLM å®¡æŸ¥è°ƒç”¨
        N --> O[ğŸ¤– è°ƒç”¨ LLM å®¡æŸ¥]
        O --> P{å®¡æŸ¥ç»“æœ}
    end
    
    subgraph æˆåŠŸè·¯å¾„
        P -->|âœ… æˆåŠŸ| Q[ğŸ“ è§£æ Markdown æ ¼å¼]
        Q --> R[ğŸ’¾ æå–å®¡æŸ¥å†…å®¹]
        R --> S[âœ… è¿”å›å®¡æŸ¥ç»“æœ]
    end
    
    subgraph é™çº§ç­–ç•¥è§¦å‘æ¡ä»¶
        P -->|âŒ å¤±è´¥ï¼ˆä¸Šä¸‹æ–‡è¶…é™ï¼‰| T[âš ï¸ ä¸Šä¸‹æ–‡è¶…é™é”™è¯¯]
        T --> U[ğŸ”” è®°å½•è­¦å‘Šæ—¥å¿—]
        U --> V[ğŸš€ è§¦å‘é™çº§ç­–ç•¥]
    end
    
    subgraph é™çº§ç­–ç•¥æµç¨‹
        V --> W[ğŸ“Š æŒ‰ä¿®æ”¹è¡Œæ•°æ’åº]
        W --> X[ğŸ“ˆ ä¼˜å…ˆå®¡æŸ¥ä¿®æ”¹æœ€å¤šçš„æ–‡ä»¶]
        X --> Y[ğŸ”„ å°è¯• 1: å®¡æŸ¥å…¨éƒ¨æ–‡ä»¶]
        Y --> Z{æˆåŠŸ?}
        Z -->|âœ…| AA[ğŸ’¾ è¿”å›å®¡æŸ¥ç»“æœ]
        Z -->|âŒ| AB[ğŸ”„ å°è¯• 2: å®¡æŸ¥ N-1 ä¸ªæ–‡ä»¶]
        
        AB --> AC{æˆåŠŸ?}
        AC -->|âœ…| AD[ğŸ’¾ è¿”å›å®¡æŸ¥ç»“æœ + æœªå®¡æŸ¥æ–‡ä»¶åˆ—è¡¨]
        AC -->|âŒ| AE[ğŸ”„ å°è¯• 3: å®¡æŸ¥ N-2 ä¸ªæ–‡ä»¶]
        
        AE --> AF{æˆåŠŸ?}
        AF -->|âœ…| AG[ğŸ’¾ è¿”å›å®¡æŸ¥ç»“æœ + æœªå®¡æŸ¥æ–‡ä»¶åˆ—è¡¨]
        AF -->|âŒ| AH[ğŸ”„ å°è¯• 4: å®¡æŸ¥ N-3 ä¸ªæ–‡ä»¶]
        
        AH --> AI{æˆåŠŸ?}
        AI -->|âœ…| AJ[ğŸ’¾ è¿”å›å®¡æŸ¥ç»“æœ + æœªå®¡æŸ¥æ–‡ä»¶åˆ—è¡¨]
        AI -->|âŒ| AK[ğŸ”„ å°è¯• 5: å®¡æŸ¥ N-4 ä¸ªæ–‡ä»¶]
        
        AK --> AL{æˆåŠŸ?}
        AL -->|âœ…| AM[ğŸ’¾ è¿”å›å®¡æŸ¥ç»“æœ + æœªå®¡æŸ¥æ–‡ä»¶åˆ—è¡¨]
        AL -->|âŒ| AN[âŒ æ‰€æœ‰é™çº§ç­–ç•¥å¤±è´¥]
    end
    
    subgraph å¤±è´¥å¤„ç†
        AN --> AO[ğŸ“ ç”Ÿæˆå‹å¥½é”™è¯¯æç¤º]
        AO --> AP[ğŸ’¡ å»ºè®®åˆ†æ‰¹æäº¤ä»£ç ]
        AP --> AQ[âœ… è¿”å›é”™è¯¯ä¿¡æ¯]
    end
    
    subgraph é™çº§ç»“æœå¢å¼º
        AD --> AR[ğŸ“‹ æ·»åŠ é™çº§è¯´æ˜]
        AG --> AR
        AJ --> AR
        AR --> AS[ğŸ“ åˆ—å‡ºæœªå®¡æŸ¥æ–‡ä»¶]
        AS --> AT[ğŸ’¾ åŒ…å«ç»Ÿè®¡ä¿¡æ¯]
        AT --> AU[âœ… è¿”å›å¢å¼ºç»“æœ]
    end

    classDef success fill:#d4edda,stroke:#28a745,stroke-width:2px;
    classDef warning fill:#fff3cd,stroke:#ffc107,stroke-width:2px;
    classDef error fill:#f8d7da,stroke:#dc3545,stroke-width:2px;
    classDef info fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px;
    
    class S,AA,AD,AG,AJ,AU success;
    class U warning;
    class AN,AQ error;
    class A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,T,V,W,X,Y,Z,AB,AC,AE,AF,AH,AI,AK,AL,AN,AR,AS,AT info;
```

## é™çº§ç­–ç•¥è¯¦ç»†è¯´æ˜

### è§¦å‘æ¡ä»¶

å½“ LLM è¿”å›ä»¥ä¸‹é”™è¯¯æ—¶ï¼Œè‡ªåŠ¨è§¦å‘é™çº§ç­–ç•¥ï¼š
- `context_length_exceeded`
- `too many tokens`
- `maximum context length exceeded`
- `This model's maximum context length is ... tokens`

### é™çº§ç­–ç•¥æ‰§è¡Œæ­¥éª¤

1. **ä¼˜å…ˆçº§æ’åº**ï¼šæŒ‰ `additions + deletions` é™åºæ’åˆ—ï¼Œä¼˜å…ˆå®¡æŸ¥ä¿®æ”¹æœ€å¤šçš„æ–‡ä»¶
2. **é€æ­¥å°è¯•**ï¼š
   - å°è¯• 1ï¼šå®¡æŸ¥å…¨éƒ¨æ–‡ä»¶
   - å°è¯• 2ï¼šå®¡æŸ¥ N-1 ä¸ªæ–‡ä»¶
   - å°è¯• 3ï¼šå®¡æŸ¥ N-2 ä¸ªæ–‡ä»¶
   - å°è¯• 4ï¼šå®¡æŸ¥ N-3 ä¸ªæ–‡ä»¶
   - å°è¯• 5ï¼šå®¡æŸ¥ N-4 ä¸ªæ–‡ä»¶

3. **å®‰å…¨ä½™é‡**ï¼šä¿ç•™ 20% çš„ Token ä½™é‡

### è¾“å‡ºç¤ºä¾‹

```markdown
## å®¡æŸ¥ç»“æœ

[æ­£å¸¸çš„å®¡æŸ¥å†…å®¹...]

---
âš ï¸ **æ³¨æ„**ï¼šç”±äºä»£ç å˜æ›´è¿‡å¤šï¼Œæ­¤å®¡æŸ¥ä»…åŒ…å« **5** ä¸ªä¿®æ”¹æœ€å¤šçš„æ–‡ä»¶ï¼ˆå…± **15** ä¸ªæ–‡ä»¶ï¼‰ã€‚

### ğŸ“ æœªå®¡æŸ¥çš„æ–‡ä»¶ï¼š
- `src/utils/helper.java`
- `src/models/service.java`
- `src/controllers/api.java`
- `src/services/business.java`
- `src/utils/validator.java`
- `src/config/database.java`
- `src/services/cache.java`
- `src/utils/logger.java`
- `src/models/dto.java`
- `src/controllers/rest.java`

### ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼š
- **æ€»æ–‡ä»¶æ•°**ï¼š15
- **å·²å®¡æŸ¥**ï¼š5
- **æœªå®¡æŸ¥**ï¼š10
- **æ€»ä¿®æ”¹è¡Œæ•°**ï¼š2,500
```

## é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `REVIEW_MAX_TOKENS` | 15000 | æ¯æ¬¡å®¡æŸ¥çš„æœ€å¤§ Token é™åˆ¶ |
| `REVIEW_STYLE` | professional | å®¡æŸ¥é£æ ¼ï¼ˆprofessional/sarcastic/gentle/humorousï¼‰ |
| `é™çº§å®‰å…¨ä½™é‡` | 0.8 | é™çº§ç­–ç•¥ä¸­ä¿ç•™çš„ Token å®‰å…¨æ¯”ä¾‹ |

## é€‚ç”¨åœºæ™¯

âœ… **å¤§å‹ä»£ç åº“**ï¼šå•æ¬¡æäº¤åŒ…å«å¤§é‡æ–‡ä»¶ä¿®æ”¹
âœ… **å¤æ‚é‡æ„**ï¼šæ¶‰åŠå¤šä¸ªæ¨¡å—çš„å¤§è§„æ¨¡ä»£ç å˜æ›´
âœ… **èµ„æºå—é™**ï¼šLLM ä¸Šä¸‹æ–‡çª—å£è¾ƒå°çš„æƒ…å†µ
âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šéœ€è¦æ§åˆ¶ API è°ƒç”¨çš„ Token æ¶ˆè€—

---

*ğŸ’¡ å»ºè®®ï¼šå¦‚æœä»£ç å˜æ›´æŒç»­è¿‡å¤šï¼Œè€ƒè™‘å°†ä»£ç åˆ†æ‰¹æäº¤è¿›è¡Œå®¡æŸ¥*
